org.alljoyn.Analytics.AnalyticsEventAgent version 1
===================================================

Theory of Operation
-------------------


### Introduction

The AllJoyn™ Analytics Service Interface is intended to provide a standard,
vendor-agnostic method of sending analytics information from devices on the
AllJoyn proximal network to analytics services in the cloud.


#### Scope

This document is targeted to the developers for AllJoyn applications.


#### Release history

| Release version | What changed                                        |
|-----------------|-----------------------------------------------------|
| 14.12           | AnalyticsEventAgent interface version 1 was added.  |


#### References

The following are reference documents found on the AllSeen Alliance web site's
Docs and Downloads section.

[Introduction to the AllJoyn Framework][1]

[1]: <https://allseenalliance.org/docs-and-downloads/documentation/introduction-alljoyn-framework>

[Introduction to AllJoyn Thin Library][2]

[2]: <https://allseenalliance.org/docs-and-downloads/documentation/introduction-alljoyn-thin-library>


Overview
--------

An agent implement the analytics interface, possibly as an AllJoyn™ Gateway
Agent. It is expected that each device manufacturer would deploy an agent
specific to its devices. The agent may run on the same physical device as the
client application, or on a separate device, depending on the manufacturer’s
requirements. Figure 1 shows the relationship between an application and the
analytics agent when running on two separate devices. Figure 2 illustrates the
same configuration, but with client and service running on the same physical
device. Figure 3 shows the analytics core linked into the application, with
AllJoyn messages replaced with direct API calls.

![](<app_service_relationship.png>)

Figure 1. Analytics service architecture within the AllJoyn framework.

![](<app_service_relationship_one_device_with_agent.png>)

Figure 2. Analytics app and agent running on same physical device.

![](<app_service_relationship_linked_agent.png>)

Figure 3. Application with analytics core linked in.


Discovery
---------

A client can discover the agent via an announcement which is a sessionless
signal containing the basic app information like app name, device name,
manufacturer, and model number. The announcement also contains the list of
object paths and service interfaces to allow the client to determine whether the
app provides functionality of interest.


### Discovery Call Flows


#### Typical discovery flow

Figure 4 illustrates a typical call flow for a client to discover a service app.
The client merely relies on the sessionless announcement to decide whether to
connect to the service app to use its service offering.

![](<about-typical-discovery.png>)

Figure 4. Typical discovery call flow.


#### Non-typical discovery flow

Figure 5 illustrates a call flow for a client to discover a service app and make
a request for more detailed information.


![](<about-nontypical-discovery.png>)

Figure 5. Non-typical discovery call flow.


AnalyticsEventAgent Call Flow
-----------------------------

Figure 6 illustrates a typical call flow for the AnalyticsEventAgent interface.

![](<analytics_call_flow.png>)

Figure 6. AnalyticsEventAgent call flow.


org.alljoyn.Analytics.AnalyticsEventAgent Specification
-------------------------------------------------------

|------------|-------------------------------|
| Version    | 1                             |
| Annotation | org.alljoyn.Bus.Secure = true |


### Properties

|------------|----------------------------------------------------------------------|
| Type       | uint16                                                               |
| Access     | read-only                                                            |
| Annotation | org.freedesktop.DBus.PropertyChanged.EmitsChangedSignal = invalidates|


### Methods

The following methods are exposed by a BusObject that implements the
org.alljoyn.Analytics.AnalyticsEventAgent interface.


#### SetDeviceData(values)

|------------|----------------------------------------------|
| Annotation | org.freedesktop.DBus.Method.NoReply = true   |


SetDeviceData is used to provide contextual information for events being
generated by the device. These typically would include the fields described in
[Table 2][3] of the *AllJoyn About Feature 1.0 Interface Specification.*

[3]: <https://allseenalliance.org/docs-and-downloads/documentation/alljoyn-about-feature-10-interface-specification#unique_19__table_825D128FF63844DCB44D197A2C9AD95C>

Input arguments:

* **values** --- UserDict --- Values to be logically included with all events.
  Example: Model version number, device serial number. The choice of data is
  up to the caller of the method. Vendor-specific requirements may cause
  errors to be thrown.


#### SetVendorData(values)

|------------|----------------------------------------------|
| Annotation | org.freedesktop.DBus.Method.NoReply = true   |


Allow the device to set vendor-specific values related to the functionality of
the vendor’s service.

Input arguments:

* **values** --- UserDict --- Vendor-specific settings related to the
  functionality of the vendor’s service. This could include API keys, upload
  protocol settings, etc.


#### RequestDelivery()

|------------|--------------------------------------------|
| Annotation | org.freedesktop.DBus.Method.NoReply = true |

Request batched data to be flushed to the vendor’s cloud service. No input
parameters required.


#### SubmitEvent(name, timestamp, sequence, values)

|------------|--------------------------------------------|
| Annotation | org.freedesktop.DBus.Method.NoReply = true |

Log an event to the analytics service.

Input arguments:

*   **name** --- string --- The name of the application event.

* **timestamp** --- uint64 --- Time at which the event occurred. This may be set
    to zero if the device does not have a real-time clock.

* **sequence** --- uint32 --- A monotonically increasing value providing a
    relative sequencing of events.

* **values** --- UserDict --- Event attributes.


### Named Types

#### dictionary UserDict

A dictionary of user-specified attributes values are limited to the following
scalar types:

* **key** --- string --- attribute name

* **value** --- one of: int32, int64, double, string --- attribute value


### Interface Errors

No custom errors are defined.

### References

* The XML definition of the [AnalyticsEventAgent interface](AnalyticsEventAgent-v1.xml)
